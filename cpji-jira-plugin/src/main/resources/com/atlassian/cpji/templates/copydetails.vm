#* @vtlvariable name="action" type="com.atlassian.cpji.action.CopyDetailsAction" *#
<html>
<head>
	<title>$i18n.getText('cpji.select.new.issue.type')</title>
</head>
<body>
<div id="stepped-process" class="content-container">
	<div class="content-related">
		<ol class="steps">
			<li class="done">$i18n.getText('cpji.select.project')</li>
			<li class="current">$i18n.getText('cpji.select.issue.type')</li>
			<li class="todo">$i18n.getText('cpji.confirmation')</li>
		</ol>
	</div>
	<div class="content-body aui-panel">
		<form action="CopyIssueToInstanceAction!default.jspa" class="aui" method="post">
			<h2>$i18n.getText('cpji.issue.type')</h2>
			<fieldset>
				<div class="field-group">
					<label for="issueType">$i18n.getText('cpji.issue.type')</label>
					<select name="issueType" id="issueType">
						#if(!$action.availableSubTaskTypes.empty)
							<optgroup label="$i18n.getText('cpji.subtask')">
								#foreach( $issueType in $action.availableSubTaskTypes)
                                    <option #if(${issueType.isSelected()}) selected #end
                                                                           value="$textutils.htmlEncode(${issueType.value})">$textutils.htmlEncode(${issueType.value})</option>
								#end
							</optgroup>
                        <optgroup label="$i18n.getText('cpji.issue.type')">
						#end
						#foreach( $issueType in $action.getAvailableIssueTypes())
							<option #if(${issueType.isSelected()}) selected #end
																   value="$textutils.htmlEncode(${issueType.value})">$textutils.htmlEncode(${issueType.value})</option>
						#end
						#if(!$action.availableSubTaskTypes.empty)
						</optgroup>
						#end
					</select>
				</div>
			</fieldset>

			#if (!$action.targetLocal)
			<h2>$i18n.getText('cpji.remote.user')</h2>
			<fieldset>
				<div class="field-group">
					<label>$i18n.getText('cpji.user.name')</label>
					<span class="field-value">$textutils.htmlEncode($action.getRemoteUserName())</span>
				</div>
				<div class="field-group">
					<label>$i18n.getText('cpji.user.full.name')</label>
					<span class="field-value">$textutils.htmlEncode($action.getRemoteFullUserName())</span>
				</div>
			</fieldset>
			#end

			#if ($action.advancedSectionVisible)
			<h2>$i18n.getText('cpji.advanced')</h2>
			<fieldset>
				#if ($action.copyCommentsSectionVisible)
				<div class="field-group" id="copy-comments-group">
					#set ($error = $action.copyCommentsErrorMessage)
					<span class="field-value #if ($error != "") disabled #end">
						<input type="checkbox" class="checkbox" id="copy-comments" name="copyComments" value="true" #if ($error != "") disabled="" #else checked="checked" #end/>
						<label for="copy-comments">$i18n.getText('cpji.copy.comments')</label>
					</span>
					#if ($error)
						<div class="warning">$error</div>
					#end
				</div>
				#end

				#if ($action.copyAttachmentsSectionVisible)
				<div class="field-group" id="copy-attachments-group">
					#set ($isEnabled = $action.copyAttachmentsEnabled)
					<span class="field-value #if (!$isEnabled) disabled #end">
						<input type="checkbox" class="checkbox" id="copy-attachments" name="copyAttachments" value="true" #if (!$isEnabled) disabled="" #else checked="checked" #end/>
						<label for="copy-attachments">$i18n.getText('cpji.copy.attachments')</label>
					</span>
					#set ($error = $action.copyAttachmentsErrorMessage)
					#if ($error)
						<div class="warning">$error</div>
					#end
				</div>
				#end

				#if ($action.copyIssueLinksSectionVisible)
				<div class="field-group" id="copy-issue-links-group">
					#set ($error = $action.copyIssueLinksErrorMessage)
					<span class="field-value #if ($error != "") disabled #end">
						<input type="checkbox" class="checkbox" id="copy-issue-links" name="copyIssueLinks" value="true" #if ($error != "") disabled="" #else checked="checked" #end/>
						<label for="copy-issue-links">$i18n.getText('cpji.copy.issue.links')</label>
					</span>
					#if ($error)
						<div class="warning">$error</div>
					#end
				</div>
				#end

				#if ($action.createIssueLinkSectionVisible)
				<div class="field-group" id="create-issue-links-group">
					<label for="remoteIssueLink">$i18n.getText('cpji.create.issue.link')</label>

					<select name="remoteIssueLink" id="remoteIssueLink">
						#foreach( $issueLink in $action.getIssueLinkOptions())
							<option value="$textutils.htmlEncode(${issueLink.value})">$textutils.htmlEncode(${issueLink.label})</option>
						#end
					</select>
				</div>
				#end
			</fieldset>
			#end

			<div class="button-container">
				<div class="buttons">
					<input type="submit" value="$i18n.getText('common.forms.next')" class="button submit"/>
				</div>
			</div>
			<input type="hidden" name="id" value="$action.id"/>
			<input type="hidden" name="atl_token" value="$action.xsrfToken"/>
			<input type="hidden" name="targetEntityLink" value="$textutils.htmlEncode($action.targetEntityLink)"/>
		</form>
	</div>
</div>
</body>
</html>
