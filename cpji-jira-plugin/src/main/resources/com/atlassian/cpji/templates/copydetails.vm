#* @vtlvariable name="action" type="com.atlassian.cpji.action.CopyDetailsAction" *#
<html>
<head>
	<title>$i18n.getText('cpji.select.new.issue.type')</title>
</head>
<body>
<div id="stepped-process" class="content-container">
	<div class="content-related">
		<ol class="steps">
			<li class="done">$i18n.getText('cpji.select.project')</li>
			<li class="current">$i18n.getText('cpji.select.issue.type')</li>
			<li class="todo">$i18n.getText('cpji.confirmation')</li>
		</ol>
	</div>
	<div class="content-body aui-panel">
		<form action="PermissionChecksAction.jspa" class="aui" method="post">
			<h2>$i18n.getText('cpji.issue.type')</h2>
			<fieldset>
				<div class="field-group">
					<label for="issueType">$i18n.getText('cpji.issue.type')</label>
					<select name="issueType" id="issueType">
						#foreach( $issueType in $action.getAvailableIssueTypes())
							<option #if(${issueType.isSelected()}) selected #end
																   value="$textutils.htmlEncode(${issueType.value})">$textutils.htmlEncode(${issueType.value})</option>
						#end
					</select>
				</div>
			</fieldset>

			<h2>$i18n.getText('cpji.remote.user')</h2>
			<fieldset>
				<div class="field-group">
					<label>$i18n.getText('cpji.user.name')</label>
					<span class="field-value">$textutils.htmlEncode($action.getRemoteUserName())</span>
				</div>
				<div class="field-group">
					<label>$i18n.getText('cpji.user.full.name')</label>
					<span class="field-value">$textutils.htmlEncode($action.getRemoteFullUserName())</span>
				</div>
			</fieldset>

			<h2>$i18n.getText('cpji.advanced')</h2>
			<fieldset>
				#if ($action.issueWithComments)
				<div class="field-group" id="copy-comments-group">
					<span class="field-value">
						<input type="checkbox" class="checkbox" id="copy-comments" name="copyComments" value="true" checked="checked"/>
						<label for="copy-comments">$i18n.getText('cpji.copy.comments')</label>
					</span>
				</div>
				#end

				#if ($action.attachmentsEnabled() && $action.issueWithAttachments)
				<div class="field-group" id="copy-attachments-group">
					 <span class="field-value">
						 #if ($action.isSALUpgradeRequired())
							 $i18n.getText('cpji.attachments.not.moved.sal')
						 #elseif ($action.remoteAttachmentsEnabled() && $action.hasCreateAttachmentsPermission())
							 <input type="checkbox" class="checkbox" id="attachments" name="copyAttachments" value="true" checked="checked"/>
							 <label for="attachments">$i18n.getText('cpji.copy.attachments')</label>
						 #elseif (!$action.remoteAttachmentsEnabled())
							 $i18n.getText('cpji.attachments.are.disabled')
						 #elseif(!$action.hasCreateAttachmentsPermission())
							 $i18n.getText('cpji.not.permitted.to.create.attachments')
						 #end
					 </span>
				</div>
				#end

				#if ($action.linksEnabled() && $action.issueWithLinks)
				<div class="field-group" id="copy-issue-links-group">
					<span class="field-value">
						<input type="checkbox" class="checkbox" id="copy-issue-links" name="copyIssueLinks" value="true" checked="checked"/>
						<label for="copy-issue-links">$i18n.getText('cpji.copy.issue.links')</label>
						#if (!$action.copyInfo.issueLinkingEnabled)
							<div class="description">$i18n.getText('cpji.remote.issue.linking.is.disabled')</div>
						#end
					</span>
				</div>
				#end

				#if ($action.linksEnabled())
				<div class="field-group" id="create-issue-links-group">
					<label for="remoteIssueLink">$i18n.getText('cpji.create.issue.link')</label>
					<select name="remoteIssueLink" id="remoteIssueLink">
						#foreach( $issueLink in $action.getIssueLinkOptions())
							<option value="$textutils.htmlEncode(${issueLink.value})">$textutils.htmlEncode(${issueLink.label})</option>
						#end
					</select>
				</div>
				#end
			</fieldset>

			<div class="button-container">
				<div class="buttons">
					<input type="submit" value="$i18n.getText('common.forms.next')" class="button submit"/>
				</div>
			</div>
			<input type="hidden" name="id" value="$action.id"/>
			<input type="hidden" name="atl_token" value="$action.xsrfToken"/>
			<input type="hidden" name="targetEntityLink" value="$textutils.htmlEncode($action.targetEntityLink)"/>
		</form>
	</div>
</div>
</body>
</html>
