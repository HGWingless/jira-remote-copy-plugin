#* @vtlvariable name="action" type="com.atlassian.cpji.action.CopyDetailsAction" *#
<html>
<head>
	<title>$i18n.getText('cpji.select.new.issue.type')</title>
</head>
<body>
<div id="stepped-process" class="content-container">
	#set($currentStep="copydetails")
	#parse("/com/atlassian/cpji/templates/steps.vm")
	<div class="content-body aui-panel">
		<form action="CopyIssueToInstanceAction!default.jspa" class="aui" method="post">
			<h2 class="formtitle">$i18n.getText('cpji.copy.details')</h2>
			<fieldset>
				<div class="field-group">
					<label for="issueType">$i18n.getText('cpji.issue.type')</label>
					<select class="singleSelect"  name="issueType" id="issueType">
						#if(!$action.availableSubTaskTypes.empty)
						<optgroup label="$i18n.getText('cpji.subtask')">
							#foreach( $issueType in $action.availableSubTaskTypes)
								<option #if(${issueType.isSelected()}) selected #end
																	   value="$textutils.htmlEncode(${issueType.value})">$textutils.htmlEncode(${issueType.value})</option>
							#end
						</optgroup>
                        <optgroup label="$i18n.getText('cpji.issue.type')">
						#end
						#foreach( $issueType in $action.getAvailableIssueTypes())
							<option #if(${issueType.isSelected()}) selected #end
																   value="$textutils.htmlEncode(${issueType.value})">$textutils.htmlEncode(${issueType.value})</option>
						#end
						#if(!$action.availableSubTaskTypes.empty)
						</optgroup>
						#end
					</select>
				</div>
			</fieldset>

			#if ($action.advancedSectionVisible)
			<fieldset class="group">
				<legend><span>$i18n.getText('cpji.details')</span></legend>
				#if ($action.copyCommentsSectionVisible)
				#set ($error = $action.copyCommentsErrorMessage)
				<div class="checkbox">
					<input type="checkbox" class="checkbox" id="copy-comments" name="copyComments" value="true" #if ($error != "") disabled="" #else checked="checked" #end/>
					<label for="copy-comments">$i18n.getText('cpji.copy.comments')</label>
					#if ($error != "")
                        <div class="warning">$error</div>
					#end
				</div>
				#end

				#if ($action.copyAttachmentsSectionVisible)
				#set ($isEnabled = $action.copyAttachmentsEnabled)
				<div class="checkbox">
					<input type="checkbox" class="checkbox" id="copy-attachments" name="copyAttachments" value="true" #if (!$isEnabled) disabled="" #else checked="checked" #end/>
					<label for="copy-attachments">$i18n.getText('cpji.copy.attachments')</label>
					#set ($error = $action.copyAttachmentsErrorMessage)
					#if ($error != "")
                        <div class="warning">$error</div>
					#end
				#end

				#if ($action.copyIssueLinksSectionVisible)
				#set ($error = $action.copyIssueLinksErrorMessage)
				<div class="checkbox">
					<input type="checkbox" class="checkbox" id="copy-issue-links" name="copyIssueLinks" value="true" #if ($error != "") disabled="" #else checked="checked" #end/>
					<label for="copy-issue-links">$i18n.getText('cpji.copy.issue.links')</label>
					#if ($error != "")
                        <div class="warning">$error</div>
					#end
				</div>
				#end
			</fieldset>
			#end
			#if ($action.createIssueLinkSectionVisible)
            <fieldset>
				<div class="field-group" id="create-issue-links-group">
					<label for="remoteIssueLink">$i18n.getText('cpji.create.issue.link')</label>
					<select class="singleSelect" name="remoteIssueLink" id="remoteIssueLink">
						#foreach( $issueLink in $action.getIssueLinkOptions())
							<option value="$textutils.htmlEncode(${issueLink.value})">$textutils.htmlEncode(${issueLink.label})</option>
						#end
					</select>
					<div class="description">$i18n.getText("cpji.creates.issue.link.between.issues")</div>
				</div>
            </fieldset>
			#end

			#if (!$action.targetLocal)
                <fieldset>
                    <div class="field-group">
                        <label>$i18n.getText('cpji.remote.user')</label>
                        <span class="field-value">$textutils.htmlEncode($action.getRemoteFullUserName()) ($textutils.htmlEncode($action.getRemoteUserName()))</span>
                    </div>
                </fieldset>
			#end

			<div class="buttons-container">
				<div class="buttons">
					<input type="submit" value="$i18n.getText('common.forms.next')" class="aui-button submit"/>
				</div>
			</div>
			<input type="hidden" name="id" value="$action.id"/>
			<input type="hidden" name="atl_token" value="$action.xsrfToken"/>
			<input type="hidden" name="targetEntityLink" value="$textutils.htmlEncode($action.targetEntityLink)"/>
		</form>
	</div>
</div>
</body>
</html>
